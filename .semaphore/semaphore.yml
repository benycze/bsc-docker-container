# Copyright 2020 by the project contributors
# SPDX-License-Identifier: GPL-3.0-only
#
# Author(s): Pavel Benacek <pavel.benacek@gmail.com>

version: v1.0
name: Ubuntu18 Based Pipeline
agent:
  machine:
    type: a1-standard-4

fail_fast:
  stop:
    when: "true"  # enable strategy for branches, tags, and pull-requests

blocks:
  - name: "Build & Test"
    task:
      jobs:
        - name: Build & Test the Image
          commands:
            - checkout
            - bash bootstrap.sh
            - docker build -t localhost/bsc-compiler --build-arg BJOBS=1 .
            - docker run -w /bluespec/bsc localhost/bsc-compiler /bin/bash -c "cd examples/smoke_test && make smoke_test"

